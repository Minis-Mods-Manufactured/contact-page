<!-- Start Calculator & Apply Now Section -->
<div class="calculator-apply-section" style="display: flex; flex-wrap: wrap; gap: 30px; margin-top: 40px;">

  <!-- CALCULATOR PANEL -->
  <div style="flex: 1; min-width: 300px;">
    <h2>Home Price Estimator</h2>

    <label>Loan Type:
      <select id="loanType" onchange="toggleLoanOptions(); calculateEstimate()">
        <option value="landHome">Land & Home Package</option>
        <option value="homeOnly">Home Only</option>
      </select>
    </label>

    <label>Loan Program:
      <select id="loanProgram" onchange="calculateEstimate()">
        <option value="va">VA/USDA - 0% Down (Gov-Backed)</option>
        <option value="fha">FHA - 3.5% Down (Gov-Backed)</option>
        <option value="conv5">Conventional - 5% Down</option>
        <option value="conv10">Conventional - 10% Down</option>
        <option value="conv20">Conventional - 20% Down</option>
      </select>
      <span title="Some lenders may offer 0% down with 750+ credit. $1,000 deposit is always required by dealership for site eval & permits.">‚ùì</span>
    </label>

    <label>Home Price ($):
      <input type="text" id="homePrice" oninput="formatAndCalculate(this)" placeholder="e.g. 120000">
    </label>

    <label>Land Improvements ($):
      <input type="text" id="improvements" oninput="formatAndCalculate(this)" placeholder="e.g. 15000">
    </label>
    <p style="font-size: 0.9em; color: gray;">üí° Typical land improvements include: clearing, septic, sewer tap, water well, grading, and utility connections.</p>

    <label>County (for surtax):
      <select id="county" onchange="calculateEstimate()">
        <option value="default">All Counties (except Escambia)</option>
        <option value="escambia">Escambia County</option>
        <option value="outOfState">Out of State (AL)</option>
      </select>
    </label>

    <label id="landCostLabel">Land Cost ($):
      <input type="text" id="landCost" oninput="formatAndCalculate(this)" placeholder="e.g. 30000">
    </label>

    <div style="border-top: 1px solid #ccc; margin-top: 20px; padding-top: 10px;">
      <p><strong>Home + Improvements Subtotal:</strong> <span id="homeSubtotal">$0</span></p>
      <p><strong>Sales Tax:</strong> <span id="taxes">$0</span></p>
      <p><strong>Land Total:</strong> <span id="landTotal">$0</span></p>
      <p><strong>Estimated Package Total:</strong> <span id="totalEstimate">$0</span></p>
    </div>

    <p style="font-size: 0.85em; color: gray;">üîé This is an estimate only. Final figures will vary based on lender, improvements, and real site conditions.</p>
  </div>

  <!-- APPLY NOW / REMINDER SECTION -->
  <div style="flex: 1; min-width: 300px;">
    <h2>Ready to Apply?</h2>
    <a href="your-link-to-application-form" class="button">Apply Now</a>
    <div style="background: #fff3cd; color: #856404; padding: 12px; margin-top: 15px; border-left: 4px solid #ffeeba;">
      <strong>Reminder:</strong><br>
      A $1,000 deposit is required by the dealership on all loan types to begin site evaluation and permitting.
    </div>
  </div>
</div>

<script>
  const formatter = new Intl.NumberFormat("en-US");

  function formatAndCalculate(input) {
    const numeric = input.value.replace(/,/g, '');
    if (!isNaN(numeric)) {
      input.value = formatter.format(numeric);
      calculateEstimate();
    }
  }

  function toggleLoanOptions() {
    const loanType = document.getElementById("loanType").value;
    const loanProgram = document.getElementById("loanProgram");
    const landCostSection = document.getElementById("landCostLabel");

    loanProgram.innerHTML = "";
    if (loanType === "landHome") {
      loanProgram.innerHTML += `<option value="va">VA/USDA - 0% Down (Gov-Backed)</option>`;
      loanProgram.innerHTML += `<option value="fha">FHA - 3.5% Down (Gov-Backed)</option>`;
    }
    loanProgram.innerHTML += `<option value="conv5">Conventional - 5% Down</option>`;
    loanProgram.innerHTML += `<option value="conv10">Conventional - 10% Down</option>`;
    loanProgram.innerHTML += `<option value="conv20">Conventional - 20% Down</option>`;

    landCostSection.style.display = (loanType === "homeOnly") ? "none" : "block";
    calculateEstimate();
  }

  function calculateEstimate() {
    const clean = str => parseFloat(str.replace(/,/g, '')) || 0;

    const loanType = document.getElementById("loanType").value;
    const loanProgram = document.getElementById("loanProgram").value;
    const county = document.getElementById("county").value;

    const home = clean(document.getElementById("homePrice").value);
    const imp = clean(document.getElementById("improvements").value);
    const land = loanType === "landHome" ? clean(document.getElementById("landCost").value) : 0;

    let govFee = 0;
    if (["va", "fha"].includes(loanProgram)) {
      govFee = home < 80000 ? 5000 : 10000;
    }

    const taxableBase = loanType === "homeOnly" ? home + imp + govFee : home + govFee;
    let taxRate = 0.03;
    let surtax = (county === "escambia") ? 75 : (county === "outOfState" ? 0 : 50);

    if (county === "outOfState") taxRate = 0.055;

    const tax = Math.round(taxableBase * taxRate + surtax);
    const homeSubtotal = home + imp + govFee;
    const total = homeSubtotal + tax + land;

    document.getElementById("homeSubtotal").innerText = formatter.format(homeSubtotal);
    document.getElementById("taxes").innerText = formatter.format(tax);
    document.getElementById("landTotal").innerText = formatter.format(land);
    document.getElementById("totalEstimate").innerText = formatter.format(total);
  }

  // Initialize on load
  toggleLoanOptions();
</script>
